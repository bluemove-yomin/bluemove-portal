{% extends 'base.html' %}

{% load static socialaccount i18n %}

{% block meta %}
<meta property="og:url" content="{% url 'member:myaccount' %}">
<meta property="og:title" content="ë¸”ë£¨ë¬´ë¸Œ í¬í„¸ - ë‚´ ê³„ì •">
<meta property="og:description" content="ë¸”ë£¨ë¬´ë¸Œ í¬í„¸ - ë‚´ ê³„ì •">
<meta name="description" content="ë¸”ë£¨ë¬´ë¸Œ í¬í„¸ - ë‚´ ê³„ì •">
<meta name="subject" content="ë¸”ë£¨ë¬´ë¸Œ í¬í„¸ - ë‚´ ê³„ì •">
<meta name="robots" content="noindex,nofollow">
{% endblock %}

{% block title %} ë¸”ë£¨ë¬´ë¸Œ í¬í„¸ - ë‚´ ê³„ì • {% endblock %}

{% block breadcrumb %}
<div class="breadcrumb-screen breadcrumb-base breadcrumb-account">
    <div class="d-flex align-items-center breadcrumb-layer">
        <div class="container-lg text-center">
            <h1 class="screenLarge m-0" style="color: #FFFFFF; text-shadow: 1px 1px 5px #212529;">ë‚´ ê³„ì •</h1>
            <h2 class="screenSmall m-0" style="color: #FFFFFF; text-shadow: 1px 1px 5px #212529;">ë‚´ ê³„ì •</h2>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="card shadow-hover">
    <div class="card-body" style="background-color: rgba(0,0,0,.025);">
        <h5 class="card-title pb-1">ê°œì¸ì •ë³´ ìˆ˜ì •</h5>
        <!-- alert -->
        {% if modified %}
        <div class="alert alert-primary alert-dismissible fade show d-flex align-items-center" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                class="bi bi-person-badge flex-shrink-0 me-2" viewBox="0 0 16 16">
                <path d="M6.5 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                <path
                    d="M4.5 0A2.5 2.5 0 0 0 2 2.5V14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2.5A2.5 2.5 0 0 0 11.5 0h-7zM3 2.5A1.5 1.5 0 0 1 4.5 1h7A1.5 1.5 0 0 1 13 2.5v10.795a4.2 4.2 0 0 0-.776-.492C11.392 12.387 10.063 12 8 12s-3.392.387-4.224.803a4.2 4.2 0 0 0-.776.492V2.5z" />
            </svg>
            <div class="vertical">
                ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! <span id="emoji"></span>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="ì•ˆë‚´ì°½ ë‹«ê¸°"></button>
        </div>
        {% endif %}
        <!-- form -->
        <form action="{% url 'member:myaccount' %}" method="POST" enctype="multipart/form-data"
            onsubmit="return validation(this)">
            {% csrf_token %}
            <div style="margin-bottom: 1rem;">
                <label for="email" class="form-label">ì´ë©”ì¼ ì£¼ì†Œ
                    <a href="#none" class="ms-1" data-bs-toggle="tooltip" data-bs-placement="right" title=""
                        data-bs-original-title="ì´ë©”ì¼ ì£¼ì†ŒëŠ” ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." style="color: #545859 !important;"
                        aria-label="ë„ì›€ë§">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-question-circle" viewBox="0 0 16 16" style="margin-bottom: .2rem;">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                            <path
                                d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z" />
                        </svg>
                    </a>
                </label>
                <input type="text" class="form-control" id="email" name="email"
                    aria-label="{{ user.last_name }}{{ user.first_name }}ë‹˜ì˜ ì´ë©”ì¼ ì£¼ì†Œ" value="{{ user.email }}" disabled>
            </div>
            <div class="row row-cols-1 row-cols-md-2 g-3">
                <div class="col">
                    <div class="d-flex justify-content-start">
                        <label for="last_name" class="form-label">ì„±</label><label for="first_name"
                            class="form-label">ëª…</label>
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control" id="last_name" name="last_name"
                            aria-label="{{ user.last_name }}{{ user.first_name }}ë‹˜ì˜ ì„± ì…ë ¥" value="{{ user.last_name }}">
                        <input type="text" class="form-control" id="first_name" name="first_name"
                            aria-label="{{ user.last_name }}{{ user.first_name }}ë‹˜ì˜ ì´ë¦„ ì…ë ¥"
                            value="{{ user.first_name }}">
                    </div>
                </div>
                <div class="col">
                    <label for="phone" class="form-label">íœ´ëŒ€ì „í™” ë²ˆí˜¸</label>
                    <input type="text" class="form-control" id="phone" name="phone"
                        aria-label="{{ user.last_name }}{{ user.first_name }}ë‹˜ì˜ íœ´ëŒ€ì „í™” ë²ˆí˜¸ ì…ë ¥" maxlength="13"
                        minlength="13" value="{{ user.profile.phone }}">
                </div>
            </div>
            <div class="d-grid" style="padding-top: 1.25rem !important;">
                <button type="submit" class="btn btn-outline-secondary" aria-label="ìˆ˜ì •">
                    <i class="bi bi-check2 me-2"></i>ìˆ˜ì •</button>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
    // validation
    $("#last_name").keyup(function () {
        var foo = $(this).val().replace(/[a-z0-9]|[ \[\]{}()<>?|`~!@#$%^&*-_+=,.;:\"\\]/g, "");
        $(this).val(foo);
    });
    $("#first_name").keyup(function () {
        var foo = $(this).val().replace(/[a-z0-9]|[ \[\]{}()<>?|`~!@#$%^&*-_+=,.;:\"\\]/g, "");
        $(this).val(foo);
    });
    $("#phone").keyup(function () {
        var foo = $(this).val().replace(/[^0-9]/g, "").replace(/(^0[0-9]{2})([0-9]+)?([0-9]{4})$/, "$1-$2-$3").replace("--", "-");
        $(this).val(foo);
    });
    function onlyNumbers(e) {
        var regInt = /[^0-9]/gi;
        var inputKeyChar = String.fromCharCode(event.keyCode);
        if (regInt.test(inputKeyChar)) {
            event.returnValue = false;
        }
    }
    function validation() {
        var patternNum = /[0-9]/; // number
        var patternSpc = /[~!@#$%^&*()_+|<>?:{}]/; // special characters
        var patternEng = /[a-zA-Z]/; // alphabet
        var patternKor = /[ã„±-ã…|ã…-ã…£|ê°€-í£]/; // Hangul
        var patternEml = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/ // email
        var lastName = document.querySelector("#last_name");
        var firstName = document.querySelector("#first_name");
        var phone = document.querySelector("#phone");
        if (lastName.value == "") {
            alert("ì„±ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (!patternKor.test(lastName.value)) {
            alert("ì„±ì€ í•œê¸€ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (firstName.value == "") {
            alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (!patternKor.test(firstName.value)) {
            alert("ì´ë¦„ì€ í•œê¸€ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (phone.value.length !== 13) {
            alert("íœ´ëŒ€ì „í™” ë²ˆí˜¸ëŠ” '010'ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìˆ«ì 11ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (!patternNum.test(phone.value)) {
            alert("íœ´ëŒ€ì „í™” ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (phone.value.indexOf("010") !== 0) {
            alert("íœ´ëŒ€ì „í™” ë²ˆí˜¸ëŠ” '010'ìœ¼ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.");
            return false;
        };
        if (phone.value.indexOf("-") !== 3 &&
            phone.value.lastIndexOf("-") !== 8) {
            alert("ì˜¬ë°”ë¥¸ íœ´ëŒ€ì „í™” ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (phone.value.match(/-/g).length !== 2) {
            alert("ì˜¬ë°”ë¥¸ íœ´ëŒ€ì „í™” ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
        if (!patternNum.test(lastName.value) &&
            !patternSpc.test(lastName.value) &&
            !patternEng.test(lastName.value) &&
            patternKor.test(lastName.value) &&
            !patternNum.test(firstName.value) &&
            !patternSpc.test(firstName.value) &&
            !patternEng.test(firstName.value) &&
            patternKor.test(firstName.value) &&
            patternNum.test(phone.value) &&
            !patternSpc.test(phone.value) &&
            !patternEng.test(phone.value) &&
            !patternKor.test(phone.value) &&
            phone.value.indexOf("010") == 0 &&
            phone.value.indexOf("-") == 3 &&
            phone.value.match(/-/g).length == 2) {
            // call 'spinner (transition)' function
            fadeOut();
            // call 'avoiding duplicate requests (btn disabled)' function
            setTimeout(inProgress, 0);
            return document.querySelector("form").submit();
        } else {
            alert("ì˜ëª»ëœ ê°’ì´ ìˆìŠµë‹ˆë‹¤.\nì˜¬ë°”ë¥¸ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        };
    };
</script>
{% if modified %}
<script type="text/javascript">
    var emoji = new Array("ğŸ˜€", "ğŸ˜", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜", "ğŸ™‚", "ğŸ¤—", "ğŸ¤©", "ğŸ‘", "ğŸ‘", "ğŸ™Œ", "ğŸ™†â€â™€ï¸", "ğŸ™†â€â™‚ï¸", "ğŸ™†");
    function randomItem(e) {
        return e[Math.floor(Math.random() * e.length)];
    }
    document.querySelector("#emoji").innerText = randomItem(emoji);
</script>
{% endif %}
{% endblock %}